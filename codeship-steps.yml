- name: reinstate SSH Private Key File
  service: app
  command: /bin/bash -c "echo -e $PRIVATE_SSH_KEY >> /root/.ssh/id_rsa"

- name: chmod id_rsa
  service: app
  command: chmod 600 /root/.ssh/id_rsa

- name: add server to list of known hosts
  service: app
  command: /bin/bash -c "ssh-keyscan -H github.com >> /root/.ssh/known_hosts"

# https://help.github.com/articles/adding-a-new-ssh-key-to-your-github-account/
- name: Confirm ssh connection to server, authenticating with generated public ssh key
  service: app
  command: /bin/bash -c "ssh -T git@github.com 2>&1 | grep 'successfully authenticated'"

- service: app
  command: git reset --hard

- service: app
  command: /bin/bash -c 'git fetch --unshallow || true'

- service: app
  command: git remote -v

- service: app
  command: git remote update

- service: app
  command: git remote -v

- service: app
  command: git fetch

- service: app
  command: git checkout -b master origin/master
